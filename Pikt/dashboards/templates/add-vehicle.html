{% extends "root.html" %}
{% load static %}
{% block content %}
{% if form.errors %}
<div class="alert-module" style="opacity: 1; display: flex; margin-bottom: 10px; background-color: #FF9494">
    <div>
        <h4 style="margin-bottom: 0px;">Error</h4>
        <ul>
            {% for field in form %}
            {% for error in field.errors %}
            <li><strong>{{ field.label }}:</strong> {{ error }}</li>
            {% endfor %}
            {% endfor %}
        </ul>
    </div>
    <button type="submit"
        style="border: none; background: none; padding: 0; margin: 0; cursor: pointer; outline: none; color: #000; font-size: 20px; margin-left: 10px; margin-top: -5px;"
        class="alert-module-link w-inline-block"><img loading="lazy"
            src="https://assets.website-files.com/6057ab51530cb39d3fdac75d/6058bf1274d92808ed9a6a84_x.svg"
            alt=""></button>
</div>
{% endif %}
<div style="border-bottom: 1px solid #e1e6f0; padding: 16px 0px">
    <div>
        <h4>Bulk Upload</h4>
        <div class="small-text">Enter vehicle VINs on its own line</div>
        <textarea id="multiVIN" rows="10" cols="10" style="resize: none; width: 100%; height: 100px"></textarea>
        <button id="decodeVinsButton" class="button button-small w-button">Decode VINs</button>
    </div>
    <div id="vinResults"></div>
    <form style="display: none;" id="multi-vehicle-submit">
        <button id="submitVehiclesButton" type="submit" class="button button-small w-button" style="height: 38px; margin-right: 10px">Add Vehicles</button>
        <div>
            <select name="category" id="category" class="text-field w-input" style="margin-bottom: 0px;" required>
                <option value="" selected disabled>Select Category</option>
                {% for category in categories %}
                {% if category in vehicle.category %}
                <option value="{{ category }}" selected>{{ category }}</option>
                {% else %}
                <option value="{{ category }}">{{ category }}</option>
                {% endif %}
                {% endfor %}
            </select>
        </div>
    </form>
</div>

<form id="wf-form-Form" onsubmit="removeDollarSign()" name="wf-form-Form" data-name="Form" method="post"
    enctype="multipart/form-data" aria-label="Form" style="margin-top: 16px">
    {% csrf_token %}
    <h4>Single Vehicle Upload</h4>
    <div class="w-layout-grid form-grid space-bottom-small" style="grid-template-columns: minmax(40%, 50%) minmax(40%, 50%);">
        <div style="display: flex; align-items: end;">
            <input type="text" class="text-field w-input" maxlength="256" name="vin" id="vin-input"
                placeholder="VIN" style="margin-right: 10px; margin-bottom: 10px" required> 
            <button  onclick="decodeVin()" class="button button-small w-button remove-row" style="height: 38px; margin-right: 5px; margin-bottom: 10px;">Go</button>
        </div>
        <div>
            <h6>Stock Number</h6>
            <input type="text" class="text-field w-input" maxlength="256" name="stock_number" id="stock_number" value="{{ stock_number }}">
        </div>
        <div>
            <h6>Year</h6>
            <select name="year" id="year" class="text-field w-select">
                <option value="" selected disabled>Select Year</option>
                {% for year in years %}
                    <option value="{{ year }}">{{ year }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <h6>Make</h6>
            <select name="make" id="make" class="text-field w-select">
                <option value="" selected disabled>Select Make</option>
                {% for make in makes_models.keys %}
                <option value="{{ make }}">{{ make }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <h6>Model</h6>
            <select name="model" id="model" class="text-field w-select">
                <option value="" selected disabled>Select Model</option>
                {% for make, models in makes_models.items %}
                <optgroup label="{{ make }}">
                    {% for model in models %}
                    <option value="{{ model }}">{{ model }}</option>
                    {% endfor %}
                </optgroup>
                {% endfor %}
            </select>
        </div>
        <div>
            <h6>Primary Damage</h6>
            <select name="primary_damage" id="primary-damage" class="text-field w-input">
                <option value="" selected disabled>Select Damage</option>
                {% for damage in damage_types %}
                <option value="{{ damage }}">{{ damage }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <h6>Secondary Damage</h6>
            <select name="secondary_damage" id="secondary-damage" class="text-field w-input">
                <option value="" selected disabled>Select Damage</option>
                {% for damage in damage_types %}
                <option value="{{ damage }}">{{ damage }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <h6>Category</h6>
            <select name="category" id="category" class="text-field w-input" required>
                <option value="" selected disabled>Select Category</option>
                {% for category in categories %}
                {% if category in vehicle.category %}
                <option value="{{ category }}" selected>{{ category }}</option>
                {% else %}
                <option value="{{ category }}">{{ category }}</option>
                {% endif %}
                {% endfor %}
            </select>
        </div>
        <div>
            <h6>Yard</h6>
            <input type="text" class="text-field w-input" maxlength="256" name="yard" id="yard">
        </div>
        <div>
            <h6>Row</h6>
            <input type="text" class="text-field w-input" maxlength="256" name="row" id="row">
        </div>
        <div>
            <h6>Location</h6>
            <select id="locationDropdown" class="dropdown text-field w-input" name="location" required>
                <option value="">Select a location</option>
                {% for location in locations %}
                <option value="{{ location.id }}">
                    {{ location.name }}
                </option>
                {% endfor %}
            </select>
        </div>
        <input type="hidden" name="latitude" id="latitude" value="">
        <input type="hidden" name="longitude" id="longitude" value="">
        <!-- <div style="grid-column: span 2;">
            <h6>Drop Pin for Vehicle Location</h6>
            <div id="mapid" style="height: 350px; margin: 12px 15px 0px 15px;"></div>
        </div>   -->
        
        <div style="grid-column: span 2;">
            <h6>Description</h6>
            <textarea class="text-field w-input" maxlength="256" name="description" id="description" rows="4" style="resize: none;"></textarea>
        </div>
        {% if user.u_pull_it_account %}
            <div data-hover="false" data-delay="0" class="dropdown w-dropdown" style="z-index: 500; grid-column: span 2">
                <div data-w-id="47f88ec0-ed82-4189-0832-39236d3f989f" class="nav-link-dropdown w-dropdown-toggle w--open"
                    style="background-color: rgb(255, 1, 116, .15) !important; opacity: 1; filter: grayscale(0%); background-color: white; border: 1px solid #e1e6f0; border-radius: 3px;" id="w-dropdown-toggle-0" aria-controls="w-dropdown-list-0"
                    aria-haspopup="menu" aria-expanded="true" role="button" tabindex="0"><img
                        style="height: 26px"
                        src="{% static 'icons/car-red.svg' %}"
                        loading="lazy" alt="" class="nav-icon">
                    <div style="color: black">Seller Details</div><img
                        src="https://assets.website-files.com/6057ab51530cb39d3fdac75d/60586d393a273570ab97cc78_chevron-down.svg"
                        loading="lazy" alt="" class="nav-dropdown-icon"
                        style="transform: translate3d(0px, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(180deg) skew(0deg, 0deg); transform-style: preserve-3d;">
                </div>
                <div class="dropdown-list w-dropdown-list"
                    style="transform: translate3d(0px, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg); transform-style: preserve-3d; opacity: 1;"
                    id="w-dropdown-list-0" aria-labelledby="w-dropdown-toggle-0">
                    <div class="w-layout-grid _2-grid" style="grid-template-columns: 1fr 1fr; padding: 10px;">
                        <div>
                            <h6>Seller Type</h6>
                            <select name="seller_type" id="seller_type" class="text-field w-input">
                                <option value="" selected disabled>Select Category</option>
                                {% for seller_type in seller_types %}
                                {% if seller_type in vehicle.seller_type %}
                                <option value="{{ seller_type }}" selected>{{ seller_type }}</option>
                                {% else %}
                                <option value="{{ seller_type }}">{{ seller_type }}</option>
                                {% endif %}
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <h6>Seller First Name</h6>
                            <input type="text" class="text-field w-input" maxlength="256" name="seller_first_name" id="seller_first_name">
                        </div>
                        <div>
                            <h6>Seller Last Name</h6>
                            <input type="text" class="text-field w-input" maxlength="256" name="seller_last_name" id="seller_last_name">
                        </div>
                        <div>
                            <h6>Seller Phone Number</h6>
                            <input type="number" class="text-field w-input" maxlength="256" name="seller_phone" id="seller_phone">
                        </div>
                        <div>
                            <h6>Seller Email Address</h6>
                            <input type="text" class="text-field w-input" maxlength="256" name="seller_email" id="seller_email">
                        </div>
                        <div>
                            <h6>Seller Street Address</h6>
                            <input type="text" class="text-field w-input" maxlength="256" name="seller_address" id="seller_address">
                        </div>
                        <div>
                            <h6>City</h6>
                            <input type="text" class="text-field w-input" maxlength="256" name="seller_city" id="seller_city">
                        </div>
                        <div>
                            <h6>State</h6>
                            <select class="text-field w-input" name="seller_state" id="seller_state">
                                <option value="">Select a state</option>
                                <option value="Alabama">Alabama</option>
                                <option value="Alaska">Alaska</option>
                                <option value="Arizona">Arizona</option>
                                <option value="Arkansas">Arkansas</option>
                                <option value="California">California</option>
                                <option value="Colorado">Colorado</option>
                                <option value="Connecticut">Connecticut</option>
                                <option value="Delaware">Delaware</option>
                                <option value="Florida">Florida</option>
                                <option value="Georgia">Georgia</option>
                                <option value="Hawaii">Hawaii</option>
                                <option value="Idaho">Idaho</option>
                                <option value="Illinois">Illinois</option>
                                <option value="Indiana">Indiana</option>
                                <option value="Iowa">Iowa</option>
                                <option value="Kansas">Kansas</option>
                                <option value="Kentucky">Kentucky</option>
                                <option value="Louisiana">Louisiana</option>
                                <option value="Maine">Maine</option>
                                <option value="Maryland">Maryland</option>
                                <option value="Massachusetts">Massachusetts</option>
                                <option value="Michigan">Michigan</option>
                                <option value="Minnesota">Minnesota</option>
                                <option value="Mississippi">Mississippi</option>
                                <option value="Missouri">Missouri</option>
                                <option value="Montana">Montana</option>
                                <option value="Nebraska">Nebraska</option>
                                <option value="Nevada">Nevada</option>
                                <option value="New Hampshire">New Hampshire</option>
                                <option value="New Jersey">New Jersey</option>
                                <option value="New Mexico">New Mexico</option>
                                <option value="New York">New York</option>
                                <option value="North Carolina">North Carolina</option>
                                <option value="North Dakota">North Dakota</option>
                                <option value="Ohio">Ohio</option>
                                <option value="Oklahoma">Oklahoma</option>
                                <option value="Oregon">Oregon</option>
                                <option value="Pennsylvania">Pennsylvania</option>
                                <option value="Rhode Island">Rhode Island</option>
                                <option value="South Carolina">South Carolina</option>
                                <option value="South Dakota">South Dakota</option>
                                <option value="Tennessee">Tennessee</option>
                                <option value="Texas">Texas</option>
                                <option value="Utah">Utah</option>
                                <option value="Vermont">Vermont</option>
                                <option value="Virginia">Virginia</option>
                                <option value="Washington">Washington</option>
                                <option value="West Virginia">West Virginia</option>
                                <option value="Wisconsin">Wisconsin</option>
                                <option value="Wyoming">Wyoming</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        {% else %}
            <div data-hover="false" data-delay="0" class="dropdown w-dropdown" style="z-index: 500; grid-column: span 2">
                <div data-w-id="47f88ec0-ed82-4189-0832-39236d3f989f" class="nav-link-dropdown w-dropdown-toggle w--open"
                    style="background-color: rgb(255, 1, 116, .15) !important; opacity: 1; filter: grayscale(0%); background-color: white; border: 1px solid #e1e6f0; border-radius: 3px;" id="w-dropdown-toggle-0" aria-controls="w-dropdown-list-0"
                    aria-haspopup="menu" aria-expanded="true" role="button" tabindex="0"><img
                        style="height: 26px"
                        src="{% static 'icons/car-red.svg' %}"
                        loading="lazy" alt="" class="nav-icon">
                    <div style="color: black">Vehicle Details</div><img
                        src="https://assets.website-files.com/6057ab51530cb39d3fdac75d/60586d393a273570ab97cc78_chevron-down.svg"
                        loading="lazy" alt="" class="nav-dropdown-icon"
                        style="transform: translate3d(0px, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(180deg) skew(0deg, 0deg); transform-style: preserve-3d;">
                </div>
                <div class="dropdown-list w-dropdown-list"
                    style="transform: translate3d(0px, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg); transform-style: preserve-3d; opacity: 1;"
                    id="w-dropdown-list-0" aria-labelledby="w-dropdown-toggle-0">
                    <div class="w-layout-grid _2-grid" style="grid-template-columns: 1fr 1fr; padding: 10px;">
                        
                        <div>
                            <h6>Vehicle Engine</h6>
                            <input type="text" class="text-field w-input" maxlength="256" name="engine" id="engine">
                        </div>
                        <div>
                            <h6>Mileage</h6>
                            <input type="number" class="text-field w-input" maxlength="256" name="mileage" id="mileage">
                        </div>
                        <div>
                            <h6>Trim</h6>
                            <input type="text" class="text-field w-input" maxlength="256" name="trim" id="trim">
                        </div>
                        <div>
                            <h6>Transmission</h6>
                            <select name="transmission" id="transmission" class="text-field w-input">
                                <option value="" selected disabled>Select Category</option>
                                <option value="Automatic">Automatic</option>
                                <option value="Manual">Manual</option>
                                <option value="CVT">CVT</option>
                                <option value="DCT">DCT</option>
                            </select>
                        </div>
                        <div>
                            <h6>Body Type</h6>
                            <input type="text" class="text-field w-input" maxlength="256" name="body_type" id="body_type">
                        </div>
                        <div>
                            <h6>Drivetrain</h6>
                            <input type="text" class="text-field w-input" maxlength="256" name="drivetrain" id="drivetrain">
                        </div>
                    </div>
                </div>
            </div>
            <div data-hover="false" data-delay="0" class="dropdown w-dropdown" style="z-index: 500; grid-column: span 2">
                <div data-w-id="47f88ec0-ed82-4189-0832-39236d3f989f" class="nav-link-dropdown w-dropdown-toggle w--open"
                    style="background-color: rgba(255, 183, 49, 0.15) !important; opacity: 1; filter: grayscale(0%); background-color: white; border: 1px solid #e1e6f0; border-radius: 3px;" id="w-dropdown-toggle-0" aria-controls="w-dropdown-list-0"
                    aria-haspopup="menu" aria-expanded="true" role="button" tabindex="0"><img
                        src="https://assets.website-files.com/6057ab51530cb39d3fdac75d/605884b47ee33f1eb5676cce_target.svg"
                        loading="lazy" alt="" class="nav-icon">
                    <div style="color: black">Interior & Exterior Colors</div><img
                        src="https://assets.website-files.com/6057ab51530cb39d3fdac75d/60586d393a273570ab97cc78_chevron-down.svg"
                        loading="lazy" alt="" class="nav-dropdown-icon"
                        style="transform: translate3d(0px, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(180deg) skew(0deg, 0deg); transform-style: preserve-3d;">
                </div>
                <div class="dropdown-list w-dropdown-list"
                    style="transform: translate3d(0px, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg); transform-style: preserve-3d; opacity: 1;"
                    id="w-dropdown-list-0" aria-labelledby="w-dropdown-toggle-0">
                    <div class="w-layout-grid _2-grid" style="grid-template-columns: 1fr 1fr; padding: 10px;">
                        <div>
                            <h6>Exterior Primary</h6>
                            <select name="exterior_primary_color" id="exterior_primary_color" class="text-field w-input">
                                <option value="" selected disabled>Select Color</option>
                                {% for color in colors %}
                                <option value="{{ color }}">{{ color }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <h6>Paint Code</h6>
                            <input type="text" class="text-field w-input" maxlength="256" name="exterior_primary_paint_code" id="exterior_primary_paint_code">
                        </div>
                        <div>
                            <h6>Exterior Secondary</h6>
                            <select name="exterior_secondary_color" id="exterior_secondary_color" class="text-field w-input">
                                <option value="" selected disabled>Select Color</option>
                                {% for color in colors %}
                                <option value="{{ color }}">{{ color }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <h6>Paint Code</h6>
                            <input type="text" class="text-field w-input" maxlength="256" name="exterior_secondary_paint_code" id="exterior_secondary_paint_code">
                        </div>
                        <div>
                            <h6>Interior Primary</h6>
                            <select name="interior_primary_color" id="interior_primary_color" class="text-field w-input">
                                <option value="" selected disabled>Select Color</option>
                                {% for color in colors %}
                                <option value="{{ color }}">{{ color }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <h6>Paint Code</h6>
                            <input type="text" class="text-field w-input" maxlength="256" name="interior_primary_paint_code" id="interior_primary_paint_code">
                        </div>
                        <div>
                            <h6>Interior Secondary</h6>
                            <select name="interior_secondary_color" id="interior_secondary_color" class="text-field w-input">
                                <option value="" selected disabled>Select Color</option>
                                {% for color in colors %}
                                <option value="{{ color }}">{{ color }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <h6>Paint Code</h6>
                            <input type="text" class="text-field w-input" maxlength="256" name="interior_secondary_paint_code" id="interior_secondary_paint_code">
                        </div>
                    </div>
                </div>
            </div>
            <div data-hover="false" data-delay="0" class="dropdown w-dropdown" style="z-index: 500; grid-column: span 2">
                <div data-w-id="47f88ec0-ed82-4189-0832-39236d3f989f" class="nav-link-dropdown w-dropdown-toggle w--open"
                    style="background-color: rgb(118, 63, 249, .15) !important; opacity: 1; filter: grayscale(0%); background-color: white; border: 1px solid #e1e6f0; border-radius: 3px;" id="w-dropdown-toggle-0" aria-controls="w-dropdown-list-0"
                    aria-haspopup="menu" aria-expanded="true" role="button" tabindex="0"><img
                        src="https://assets.website-files.com/6057ab51530cb39d3fdac75d/605882d03baf8a2d544bd28f_dollar-sign.svg"
                        loading="lazy" alt="" class="nav-icon">
                    <div style="color: black">Costs & Fees</div><img
                        src="https://assets.website-files.com/6057ab51530cb39d3fdac75d/60586d393a273570ab97cc78_chevron-down.svg"
                        loading="lazy" alt="" class="nav-dropdown-icon"
                        style="transform: translate3d(0px, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(180deg) skew(0deg, 0deg); transform-style: preserve-3d;">
                </div>
                <div class="dropdown-list w-dropdown-list"
                    style="transform: translate3d(0px, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg); transform-style: preserve-3d; opacity: 1;"
                    id="w-dropdown-list-0" aria-labelledby="w-dropdown-toggle-0">
                    <div class="w-layout-grid _2-grid" style="grid-template-columns: 1fr 1fr; padding: 10px;">
                        <div>
                            <h6>Total Cost</h6>
                            <input type="text" placeholder="$0.00" class="text-field w-input" maxlength="256" name="total_cost" id="total_cost" oninput="formatInput(this)">
                        </div>
                        <div>
                            <h6>For Sale Price</h6>
                            <input type="text" placeholder="$0.00" class="text-field w-input" maxlength="256" name="for_sale_price" id="for_sale_price" oninput="formatInput(this)">
                        </div>
                        <div>
                            <h6>Bid Amount</h6>
                            <input type="text" placeholder="$0.00" class="text-field w-input" maxlength="256" name="bid_amount" id="bid_amount" oninput="formatInput(this)">
                        </div>
                        <div>
                            <h6>Auction Fee</h6>
                            <input type="text" placeholder="$0.00" class="text-field w-input" maxlength="256" name="auction_fee" id="auction_fee" oninput="formatInput(this)">
                        </div>
                        <div>
                            <h6>Buyer Fee</h6>
                            <input type="text" placeholder="$0.00" class="text-field w-input" maxlength="256" name="buyer_fee" id="buyer_fee" oninput="formatInput(this)">
                        </div>
                        <div>
                            <h6>Internet Fee</h6>
                            <input type="text" placeholder="$0.00" class="text-field w-input" maxlength="256" name="internet_fee" id="internet_fee" oninput="formatInput(this)">
                        </div>
                        <div>
                            <h6>Tow Fee</h6>
                            <input type="text" placeholder="$0.00" class="text-field w-input" maxlength="256" name="tow_fee" id="tow_fee" oninput="formatInput(this)">
                        </div>
                        <div>
                            <h6>Dismantler Cost</h6>
                            <input type="text" placeholder="$0.00" class="text-field w-input" maxlength="256" name="dismantler_cost" id="dismantler_cost" oninput="formatInput(this)">
                        </div>
                        <div>
                            <h6>Storage Fee</h6>
                            <input type="text" placeholder="$0.00" class="text-field w-input" maxlength="256" name="storage_fee" id="storage_fee" oninput="formatInput(this)">
                        </div>
                        <div>
                            <h6>Pullout Fee</h6>
                            <input type="text" placeholder="$0.00" class="text-field w-input" maxlength="256" name="pullout_fee" id="pullout_fee" oninput="formatInput(this)">
                        </div>
                        <div>
                            <h6>Misc Fee</h6>
                            <input type="text" placeholder="$0.00" class="text-field w-input" maxlength="256" name="misc_fee" id="misc_fee" oninput="formatInput(this)">
                        </div>
                    </div>
                </div>
            </div>
            <div data-hover="false" data-delay="0" class="dropdown w-dropdown" style="z-index: 500; grid-column: span 2">
                <div data-w-id="47f88ec0-ed82-4189-0832-39236d3f989f" class="nav-link-dropdown w-dropdown-toggle w--open"
                    style="background-color: rgb(1, 221, 165, .15) !important; opacity: 1; filter: grayscale(0%); background-color: white; border: 1px solid #e1e6f0; border-radius: 3px;" id="w-dropdown-toggle-0" aria-controls="w-dropdown-list-0"
                    aria-haspopup="menu" aria-expanded="true" role="button" tabindex="0"><img
                        src="https://assets.website-files.com/6057ab51530cb39d3fdac75d/6058831adf921f01483b3167_tag.svg"
                        loading="lazy" alt="" class="nav-icon">
                    <div style="color: black">Acquisition & Disposal Details</div><img
                        src="https://assets.website-files.com/6057ab51530cb39d3fdac75d/60586d393a273570ab97cc78_chevron-down.svg"
                        loading="lazy" alt="" class="nav-dropdown-icon"
                        style="transform: translate3d(0px, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(180deg) skew(0deg, 0deg); transform-style: preserve-3d;">
                </div>
                <div class="dropdown-list w-dropdown-list"
                    style="transform: translate3d(0px, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg); transform-style: preserve-3d; opacity: 1;"
                    id="w-dropdown-list-0" aria-labelledby="w-dropdown-toggle-0">
                    <div class="w-layout-grid _2-grid" style="grid-template-columns: 1fr 1fr; padding: 10px;">
                        <div>
                            <h6>Buyer</h6>
                            <input type="text" class="text-field w-input" maxlength="256" name="buyer" id="buyer">
                        </div>
                        <div>
                            <h6>Purchase Date</h6>
                            <input type="date" class="text-field w-input" maxlength="256" name="purchase_date" id="purchase_date">
                        </div>
                        <div>
                            <h6>Possession Date</h6>
                            <input type="date" class="text-field w-input" maxlength="256" name="possession_date" id="possession_date">
                        </div>
                        <div>
                            <h6>Cleared Date</h6>
                            <input type="date" class="text-field w-input" maxlength="256" name="cleared_date" id="cleared_date">
                        </div>
                        <div>
                            <h6>Towed By</h6>
                            <input type="text" class="text-field w-input" maxlength="256" name="towed_by" id="towed_by">
                        </div>
                        <div>
                            <h6>Inventoried Date</h6>
                            <input type="date" class="text-field w-input" maxlength="256" name="inventoried_date" id="inventoried_date">
                        </div>
                        <div>
                            <h6>Dismantled By</h6>
                            <input type="text" class="text-field w-input" maxlength="256" name="dismantled_by" id="dismantled_by">
                        </div>
                        <div>
                            <h6>Dismanted Date</h6>
                            <input type="date" class="text-field w-input" maxlength="256" name="dismantled_date" id="dismantled_date">
                        </div>
                        <div>
                            <h6>Crush Date</h6>
                            <input type="date" class="text-field w-input" maxlength="256" name="crush_date" id="crush_date">
                        </div>
                        <div>
                            <h6>Sold Date</h6>
                            <input type="date" class="text-field w-input" maxlength="256" name="sold_date" id="sold_date">
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            <div data-hover="false" data-delay="0" class="dropdown w-dropdown" style="z-index: 500; grid-column: span 2">
                <div data-w-id="47f88ec0-ed82-4189-0832-39236d3f989f" class="nav-link-dropdown w-dropdown-toggle w--open"
                    style="background-color: rgb(132, 173, 199, .15) !important; opacity: 1; filter: grayscale(0%); background-color: white; border: 1px solid #e1e6f0; border-radius: 3px;" id="w-dropdown-toggle-0" aria-controls="w-dropdown-list-0"
                    aria-haspopup="menu" aria-expanded="true" role="button" tabindex="0"><img
                        style="height: 26px"
                        src="{% static 'icons/camera.svg' %}"
                        loading="lazy" alt="" class="nav-icon">
                    <div style="color: black">Vehicle Images</div><img
                        src="https://assets.website-files.com/6057ab51530cb39d3fdac75d/60586d393a273570ab97cc78_chevron-down.svg"
                        loading="lazy" alt="" class="nav-dropdown-icon"
                        style="transform: translate3d(0px, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(180deg) skew(0deg, 0deg); transform-style: preserve-3d;">
                </div>
                <div class="dropdown-list w-dropdown-list"
                    style="transform: translate3d(0px, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg); transform-style: preserve-3d; opacity: 1;"
                    id="w-dropdown-list-0" aria-labelledby="w-dropdown-toggle-0">
                    <div class="w-layout-grid _2-grid" style="grid-template-columns: 1fr 1fr; padding: 10px;">
                        <div>
                            <h6>Image 1</h6>
                            <input type="file" id="images" name="image_1" accept="image/*" class="text-field w-input">
                        </div>
                        <div>
                            <h6>Image 2</h6>
                            <input type="file" id="images" name="image_2" accept="image/*" class="text-field w-input">
                        </div>
                        <div>
                            <h6>Image 3</h6>
                            <input type="file" id="images" name="image_3" accept="image/*" class="text-field w-input">
                        </div>
                        <div>
                            <h6>Image 4</h6>
                            <input type="file" id="images" name="image_4" accept="image/*" class="text-field w-input">
                        </div>
                        <div>
                            <h6>Image 5</h6>
                            <input type="file" id="images" name="image_5" accept="image/*" class="text-field w-input">
                        </div>
                        <div>
                            <h6>Image 6</h6>
                            <input type="file" id="images" name="image_6" accept="image/*" class="text-field w-input">
                        </div>
                        <div>
                            <h6>Image 7</h6>
                            <input type="file" id="images" name="image_7" accept="image/*" class="text-field w-input">
                        </div>
                        <div>
                            <h6>Image 8</h6>
                            <input type="file" id="images" name="image_8" accept="image/*" class="text-field w-input">
                        </div>
                        <div> 
                            <h6>Image 9</h6>
                            <input type="file" id="images" name="image_9" accept="image/*" class="text-field w-input">
                        </div>
                        <div>
                            <h6>Image 10</h6>
                            <input type="file" id="images" name="image_10" accept="image/*" class="text-field w-input">
                        </div>
                    </div>
                </div>
            </div>
        

    </div>
    <input type="submit" value="Add Vehicle" data-wait="Please wait..." class="button button-small w-button">
</form>
<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script> -->

<script>

    document.getElementById('decodeVinsButton').addEventListener('click', async function() {
        var textarea = document.getElementById('multiVIN');
        var vins = textarea.value.split('\n');

        var resultsContainer = document.getElementById('vinResults');
        resultsContainer.innerHTML = ''; // Clear previous results

        document.getElementById('decodeVinsButton').style.display = 'none';

        for (let vin of vins) {
            // Trim whitespace and check the length of the VIN
            vin = vin.trim();
            if (vin.length > 17) {
                alert("One or more VINs are longer than 17 characters. Please re-enter VIN's.");
                textarea.value = ''; // Clear the textarea
                resultsContainer.innerHTML = ''; // Also clear any previously added divs
                document.getElementById('decodeVinsButton').style.display = 'block'; // Show the decode button again
                document.getElementById('multi-vehicle-submit').style.display = 'none'; // Hide the submit button
                return; // Exit the function to stop further processing
            }

            await decodeAndDisplayVin(vin, resultsContainer);
        }
        document.getElementById('multi-vehicle-submit').style.display = 'flex';
    });


    async function decodeAndDisplayVin(vin, container) {
        if (vin) {
            try {
                const response = await fetch(`https://vpic.nhtsa.dot.gov/api/vehicles/decodevin/${vin}?format=json`);
                const data = await response.json();
                if (data.Results) {
                    // Process the data and create elements to display
                    // For simplicity, let's just show the Make, Model, and Year
                    const make = data.Results.find(result => result.Variable === "Make").Value;
                    const model = data.Results.find(result => result.Variable === "Model").Value;
                    const year = data.Results.find(result => result.Variable === "Model Year").Value;

                    const div = document.createElement('div');
                    div.classList.add('vin-decode-result');
                    // Set data attributes for VIN, Year, Make, and Model
                    div.setAttribute('data-vin', vin);
                    div.setAttribute('data-year', year);
                    div.setAttribute('data-make', make);
                    div.setAttribute('data-model', model);

                    // Set a more human-readable format for display, if desired
                    div.textContent = `VIN: ${vin} - Year: ${year}, Make: ${make}, Model: ${model}`;

                    container.appendChild(div);
                }
            } catch (error) {
                console.error('Error decoding VIN:', error);
                // Optionally, handle errors more gracefully, e.g., by showing a message to the user
            }
        }
    }

    document.getElementById('multi-vehicle-submit').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent the form from submitting in the traditional way
        submitVehicles(); // Call the function to handle the submission
    });


    async function submitVehicles() {
        // Extract information from each .vin-decode-result element and create a library of vehicles
        const results = document.querySelectorAll('.vin-decode-result');
        const vehicles = Array.from(results).map(result => ({
            vin: result.getAttribute('data-vin'),
            year: result.getAttribute('data-year'),
            make: result.getAttribute('data-make'),
            model: result.getAttribute('data-model')
        }));

        const category = document.getElementById('category').value;


        let params = new URLSearchParams();
        params.append('vehicles', JSON.stringify(vehicles));
        params.append('category', category);
        fetch("{% url 'add_vehicle' %}?" + params, {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-Request-Type': 'multiVehicleUpload'
            },
        })
        .then(response => response.text())
        .then(html => {
            location.reload()
        })
        .catch(error => console.error('Error:', error));
    }






    googleSat = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{
        maxZoom: 20,
        subdomains:['mt0','mt1','mt2','mt3']
    });
    var myMap = L.map('mapid').setView([40.143517089593566, -111.62220182251667], 17);
    googleSat.addTo(myMap);
    
    function changeMapView(lat, lng) {
        myMap.setView(new L.LatLng(lat, lng), 17);
    }

    // Variable to store the current marker
    var currentMarker = null;

    myMap.on('pm:create', function(e) {
        if (e.shape === "Marker") {
            // Remove the existing marker if there is one
            if (currentMarker) {
                myMap.removeLayer(currentMarker);
            }

            // Update the current marker with the new one
            currentMarker = e.layer;

            // Get latitude and longitude from the created marker
            var lat = e.layer.getLatLng().lat;
            var lng = e.layer.getLatLng().lng;

            // Update hidden input fields
            document.getElementById('latitude').value = lat;
            document.getElementById('longitude').value = lng;

            // Optional: Bind a popup to the new marker
            currentMarker.bindPopup("<strong>Location Selected</strong>").openPopup();

            // Optionally, disable further marker creation - remove this line if you want to allow marker replacement
            myMap.pm.disableDraw('Marker');
        }
    });

    document.getElementById('locationDropdown').addEventListener('change', function() {
        let queryParams = new URLSearchParams();
        queryParams.append('location_id', this.value);
        fetch("{% url 'add_vehicle' %}?" + queryParams.toString(), {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-Request-Type': 'vehicleLocations'
            }
        })
        .then(response => response.json())
        .then(data => {
            lat = data['lat'];
            lng = data['lng'];
            vehicles = data['vehicles'];
            for (let i = 0; i < vehicles.length; i++) {
                const vehicle = vehicles[i];
                if (vehicle.fields.latitude != null && vehicle.fields.longitude != null){
                    iconColor = "#57db1c";
                    if (vehicle.fields.category == "ENROUTE" || vehicle.fields.category == "PROCESSING"){
                        iconColor = "#fff004"
                    } else if (vehicle.fields.category == "CRUSHED"){
                        iconColor = "#f44336"
                    } else if (vehicle.fields.category == "YARD"){
                        iconColor = "#4336f4"
                    } else if (vehicle.fields.category == "SOLD"){
                        iconColor = "#57db1c"
                    }
                    else {
                        iconColor = "#46e6bc"
                    }

                    customMarker = {
                        radius: 5,
                        fillColor: iconColor,
                        color: iconColor,
                        weight: 5,
                        opacity: 1,
                        fillOpacity: 0.8
                    };
                    const marker = L.circleMarker([vehicle.fields.latitude, vehicle.fields.longitude], customMarker).addTo(myMap);
                    marker.bindPopup(`<strong>${vehicle.fields.year} ${vehicle.fields.make} ${vehicle.fields.model}<br>STK: ${vehicle.fields.stock_number}<br>${vehicle.fields.category}</strong>`);
                }
            }
            changeMapView(lat, lng);
        })
        .catch(error => console.error('Error:', error));
    });
    // Enable GeoMan with default toolbar
    myMap.pm.addControls(); 
        myMap.pm.addControls({
        position: 'topright', // Position of the toolbar
        drawCircle: false,    // Disable circle drawing
        drawCircleMarker: false,
        drawText: false,
        drawMarker: true,     // Enable marker drawing
        drawPolygon: false,    // Enable polygon drawing
        drawPolyline: false,  // Disable polyline drawing
        drawRectangle: false, // Disable rectangle drawing
        editMode: false,       // Enable edit mode
        dragMode: false,       // Enable drag mode
        cutPolygon: false,    // Disable cut mode
        removalMode: true,    // Enable removal mode
        rotateMode: false,

    });
    (function ($) {
        $(document).ready(function () {
            $('#fitment-location').select2({
                placeholder: 'Select Part Fitment Location',
                allowClear: true
            });
        });
    })(jQuery);
    (function ($) {
        $(document).ready(function () {
            $('#fitment-year').select2({
                placeholder: 'Year',
                allowClear: true
            });
        });
    })(jQuery);
    (function ($) {
        $(document).ready(function () {
            $('#year_fitment').select2({
                placeholder: 'Select Part Fitment Location',
                allowClear: true,
                closeOnSelect: false
            });
        });
    })(jQuery);
    function formatInput(input) {
        let value = input.value.replace(/\D/g, '');
        value = (value / 100).toFixed(2);
        input.value = value;
    }
    var makesModels = {{ makes_models| safe }};
    $(document).ready(function () {
        $('#make').change(function () {
            var selectedMake = $(this).val();
            var models = makesModels[selectedMake];
            $('#model').empty();
            $('#model').append('<option value="" selected disabled>Select Model</option>');
            $.each(models, function (index, model) {
                $('#model').append('<option value="' + model + '">' + model + '</option>');
            });
        });
    });
    var makesModelsFitment = {{ makes_models| safe }};
    $(document).on('change', '.make_fitment', function () {
        var selectedMake = $(this).val();
        var models = makesModelsFitment[selectedMake];
        var $vehicleModelFitment = $(this).closest('div').find('.model_fitment'); // Use class instead of ID
        $vehicleModelFitment.empty();
        $vehicleModelFitment.append('<option value="" selected disabled>Select Model</option>');
        $.each(models, function (index, model) {
            $vehicleModelFitment.append('<option value="' + model + '">' + model + '</option>');
        });
        $vehicleModelFitment.select2(); // Re-initialize select2 on the new models dropdown
    });

    $(document).ready(function() {
        $('.make_fitment, .model_fitment').select2({
            width: '100%' // Adjust this as necessary
        });
    });
    document.addEventListener('click', function(event) {
        // Check if the clicked element is an 'X' button
        if (event.target.matches('.remove-row')) {
            event.preventDefault();
            var row = event.target.closest('.form-row'); // Replace '.form-row' with the actual class or identifier of your row
            
            // Remove the 'required' attribute from all inputs and selects in this row
            row.querySelectorAll('input, select').forEach(function(input) {
                input.removeAttribute('required');
            });
            
            // Now remove the row from the DOM
            row.remove();
        }
    });
    async function decodeVin() {
        var vin = document.getElementById('vin-input').value;
        if (vin) {
            try {
                const response = await fetch(`https://vpic.nhtsa.dot.gov/api/vehicles/decodevin/${vin}?format=json`);
                const data = await response.json();
                if (data.Results) {
                    // Example: Fill the 'Vehicle Make' field
                    const make = data.Results.find(result => result.Variable === "Make");
                    const model = data.Results.find(result => result.Variable === "Model");
                    const year = data.Results.find(result => result.Variable === "Model Year");
                    const displacement = data.Results.find(result => result.Variable === "Displacement (L)");
                    const trim = data.Results.find(result => result.Variable === "Trim");   
                    const series = data.Results.find(result => result.Variable === "Series");

                    const makeSelect = document.getElementById('make');
                    for (let option of makeSelect.options) {
                        if (option.text.toUpperCase() === make.Value || option.value.toUpperCase() === make.Value) {
                            option.selected = true;
                            $('#make').trigger('change');
                            break;
                        }
                    }
                    const modelSelect = document.getElementById('model');
                    for (let option of modelSelect.options) {
                        if (option.text.toUpperCase() === model.Value.toUpperCase() || option.value.toUpperCase() === model.Value.toUpperCase()) {
                            option.selected = true;
                            $('#model').trigger('change');
                            break;
                        }
                    }
                    const yearSelect = document.getElementById('year');
                    for (let option of yearSelect.options) {
                        if (option.text.toUpperCase() === year.Value.toUpperCase() || option.value.toUpperCase() === year.Value.toUpperCase()) {
                            option.selected = true;
                            $('#year').trigger('change');
                            break;
                        }
                    }
                    const engineInput = document.getElementById('engine');
                    engineInput.value = displacement.Value;
                    const trimInput = document.getElementById('trim');
                    if (trim.Value && series.Value){
                        trimInput.value = trim.Value + ' ' + series.Value;
                    }
                    else if(trim.Value){
                        trimInput.value = trim.Value;
                    } else if (series.Value){
                        trimInput.value = series.Value;
                    }


                }
            } catch (error) {
                console.error('Error decoding VIN:', error);
            }
        }
    }



</script>
<style>
    .vin-decode-result {
        background-color: #e1e6f0;
        border-radius: 8px;
        padding: 6px;
        margin-bottom: 5px;
        box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .mobile-bar{
        z-index: 1001;
    }
    .leaflet-top {
        z-index: 400 !important;
    }
    .sidebar-content {
        z-index: 1000 !important;
    }
    .nav-link-dropdown {
        filter: none !important;
        box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    .nav-link-dropdown {
        filter: none !important;
        -webkit-filter: none !important;
    }
    .w-dropdown {
        z-index: 1 !important;
    }
    .w-layout-grid._2-grid {
        border:1px solid #e1e6f0; 
        border-radius: 5px;
        box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    .form-row{
        margin-bottom: 10px;
    }
    .selection span {
        border-style: none !important;
    }
    .select2 {
        width: 100% !important;
        max-width: 100% !important;
        height: 38px !important;
    }
    .select2-selection__arrow{
        margin-right: 5px !important;
    }
    .select2-selection {
        height: 38px !important;
        border: 1px solid #e3e3e3 !important;
    }
    span.select2-selection.select2-selection--single {
        border: 1px solid #e1e6f0 !important;
        margin-right: 5px !important;
    }
    span.select2-selection.select2-selection--multiple {
        border: 1px solid #e1e6f0 !important;
        max-height: 100px;
        max-width: 28.75vw !important;
        overflow-y: auto;
    }
    
    

</style>
{% endblock %}