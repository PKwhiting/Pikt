{% extends "root.html" %}

{% block content %}

    <div class="dashboard-container">
        <div data-duration-in="300" data-duration-out="100" data-current="Overview" data-easing="ease" class="w-tabs">
            <div class="in-page-menu w-tab-menu" role="tablist"><a data-w-tab="All"
                    class="in-page-menu-link w-inline-block w-tab-link w--current" id="w-tabs-0-data-w-tab-0"
                    href="#w-tabs-0-data-w-pane-0" role="tab" aria-controls="w-tabs-0-data-w-pane-0"
                    aria-selected="true">
                    <div>All</div>
                </a><a data-w-tab="Incoming" class="in-page-menu-link w-inline-block w-tab-link" id="w-tabs-0-data-w-tab-1"
                    href="#w-tabs-0-data-w-pane-1" role="tab" aria-controls="w-tabs-0-data-w-pane-1"
                    aria-selected="false" tabindex="-1">
                    <div>Incoming</div>
                </a><a data-w-tab="Holding" class="in-page-menu-link w-inline-block w-tab-link" id="w-tabs-0-data-w-tab-1"
                    href="#w-tabs-0-data-w-pane-1" role="tab" aria-controls="w-tabs-0-data-w-pane-1"
                    aria-selected="false" tabindex="-1">
                    <div>Holding</div>
                </a><a data-w-tab="Pre-Strip" class="in-page-menu-link w-inline-block w-tab-link" id="w-tabs-0-data-w-tab-2"
                    href="#w-tabs-0-data-w-pane-2" role="tab" aria-controls="w-tabs-0-data-w-pane-2"
                    aria-selected="false" tabindex="-1">
                    <div>Pre Strip</div>
                </a><a data-w-tab="Stripping" class="in-page-menu-link w-inline-block w-tab-link" id="w-tabs-0-data-w-tab-2"
                    href="#w-tabs-0-data-w-pane-2" role="tab" aria-controls="w-tabs-0-data-w-pane-2"
                    aria-selected="false" tabindex="-1">
                    <div>Stripping</div>
                </a><a data-w-tab="Pre-Yard" class="in-page-menu-link w-inline-block w-tab-link" id="w-tabs-0-data-w-tab-2"
                    href="#w-tabs-0-data-w-pane-2" role="tab" aria-controls="w-tabs-0-data-w-pane-2"
                    aria-selected="false" tabindex="-1">
                    <div>Pre Yard</div>
                </a>
                <a data-w-tab="For-Sale" class="in-page-menu-link w-inline-block w-tab-link" id="w-tabs-0-data-w-tab-2"
                href="#w-tabs-0-data-w-pane-2" role="tab" aria-controls="w-tabs-0-data-w-pane-2"
                aria-selected="false" tabindex="-1">
                <div>For Sale</div>
            </a></div>
            <div id="vehicle-map" class="mobile-map" style="height: 300px; margin-bottom: 16px; border-radius: 3px;"></div>
            <div class="tabs-content w-tab-content">
                <div data-w-tab="All" class="w-tab-pane w--tab-active" id="w-tabs-0-data-w-pane-0" role="tabpanel"
                    aria-labelledby="w-tabs-0-data-w-tab-0" style="opacity: 1; transition: opacity 300ms ease 0s;">
                    <div class="w-layout-grid main-grid">
                        <!-- <div style="display: flex; justify-content: flex-end;">
                            <div style="margin-right: 15px">
                                <input id="filter-button" type="button" value="Filter Vehicles"
                                        class="button button-small w-button filter-button" style="display: none;">
                            </div>
                            {% if user.u_pull_it_account %}
                                <div style="margin-right: 15px">
                                    <a href="/dashboards/add-vehicle/"><input type="button" value="+ Add Vehicle"
                                            class="button button-small w-button bg-primary-green"></a>
                                </div>
                            {% else %}
                                <div style="margin-right: 15px">
                                    <a href="/dashboards/add-vehicle/"><input type="button" value="Inventory Vehicle"
                                            class="button button-small w-button bg-primary-green"></a>
                                </div>
                            {% endif %}
                        </div> -->
                        <div class="w-layout-grid grid">
                            <div class="style-guide-padding">
                                <h6>Filters</h6>
                                <form id="filter-form" class="w-layout-grid _3-grid" style="grid-row-gap: 5px !important;" onsubmit="event.preventDefault(); submitFilterForm();">
                                        <div id="w-node-c0adb514-f4ff-0d6d-6bd8-03d2a5bc879e-a2dac75e">
                                            <div style="display: flex;">
                                                <div style="margin-right: 10px; width: 50%">
                                                    <select name="year_start" id="Year-Start" class="text-field w-select" required="" onchange="submitFilterForm()">
                                                        <option value="" selected disabled>Select Min Year</option>
                                                        {% for year in years %}
                                                        <option value="{{ year }}">{{ year }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                                <div style="width: 50%;">
                                                    <!-- <h6>Year End</h6> -->
                                                    <select name="year_end" id="Year-End" class="text-field w-select" required="" onchange="submitFilterForm()">
                                                        <option value="" selected disabled>Select Max Year</option>
                                                        {% for year in years %}
                                                        <option value="{{ year }}">{{ year }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="w-node-c0adb514-f4ff-0d6d-6bd8-03d2a5bc87a1-a2dac75e"  style="display: flex;">
                                            <div style="margin-right: 12px">
                                                <!-- <h6>Vehicle Model</h6> -->
                                                <input type="text" class="text-field w-input" maxlength="256" placeholder="Make" name="vehicle_make" id="Vehicle-Make"
                                                    required="" onkeyup="submitFilterForm()"">
                                            </div>
                                            <div>
                                                <!-- <h6>Vehicle Model</h6> -->
                                                <input type="text" class="text-field w-input" maxlength="256" placeholder="Model" name="vehicle_model" id="Vehicle-Model"
                                                    required="" onkeyup="submitFilterForm()">
                                            </div>
                                        </div>
                                        <div id="w-node-c0adb514-f4ff-0d6d-6bd8-03d2a5bc87a1-a2dac75e">
                                            <div>
                                                <!-- <h6>Vehicle Model</h6> -->
                                                <input type="text" class="text-field w-input" maxlength="256" placeholder="Stock Number" name="stock_number" id="Vehicle-Stock-Number"
                                                    required="" onkeyup="submitFilterForm()">
                                            </div>
                                        </div>
                                        <div id="w-node-c0adb514-f4ff-0d6d-6bd8-03d2a5bc87a7-a2dac75e">
                                            <div>
                                                <!-- <h6>Part Type</h6> -->
                                                <select name="category" id="category" class="text-field w-select" required onchange="submitFilterForm()">
                                                    <option value="" selected disabled>Select Category</option>
                                                    {% for category in categories %}
                                                    {% if category in vehicle.category %}
                                                    <option value="{{ category }}" selected>{{ category }}</option>
                                                    {% else %}
                                                    <option value="{{ category }}">{{ category }}</option>
                                                    {% endif %}
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                        <div id="w-node-c0adb514-f4ff-0d6d-6bd8-03d2a5bc87a1-a2dac75e">
                                            <div>
                                                <!-- <h6>Vehicle Model</h6> -->
                                                <input type="text" class="text-field w-input" maxlength="256" placeholder="VIN" name="vin" id="vin"
                                                    required="" onkeyup="submitFilterForm()">
                                            </div>
                                        </div>
                                        <a id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#" class="button bg-primary-rose w-inline-block" style="width: 100%; display: flex; align-items: center; height: 37px;" onclick="clearFilters()">
                                            <div>Clear</div>
                                        </a>
                                </form>
                            </div>
                        </div>
                        <div id="myModal" class="modal">
                            <div class="modal-content">
                                <span class="close">&times;</span>
                                <h6>Filters</h6>
                                <form id="filter-form-modal" class="w-layout-grid _3-grid" onsubmit="event.preventDefault(); submitFilterModalForm();" style="width: 100%">
                                    <div id="w-node-c0adb514-f4ff-0d6d-6bd8-03d2a5bc879e-a2dac75e">
                                        <div style="display: flex;">
                                            <div style="margin-right: 10px; width: 50%">
                                                <select name="year_start" id="Year-Start-Modal" class="text-field w-select" required="" onchange="submitFilterModalForm()">
                                                    <option value="" selected disabled>Select Year</option>
                                                    {% for year in years %}
                                                    <option value="{{ year }}">{{ year }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div style="width: 50%;">
                                                <!-- <h6>Year End</h6> -->
                                                <select name="year_end" id="Year-End-Modal" class="text-field w-select" required="" onchange="submitFilterModalForm()">
                                                    <option value="" selected disabled>Select Year</option>
                                                    {% for year in years %}
                                                    <option value="{{ year }}">{{ year }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="w-node-c0adb514-f4ff-0d6d-6bd8-03d2a5bc87a1-a2dac75e" style="display: flex;">
                                        <div style="margin-right: 12px;">
                                            <input type="text" class="text-field w-input" maxlength="256" placeholder="Vehicle Make" name="vehicle_make" id="Vehicle-Make-Modal"
                                                required="" onkeyup="submitFilterModalForm()">
                                        </div>
                                        <div>
                                            <input type="text" class="text-field w-input" maxlength="256" placeholder="Vehicle Model" name="vehicle_model" id="Vehicle-Model-Modal"
                                                required="" onkeyup="submitFilterModalForm()">
                                        </div>
                                    </div>
                                    <div>
                                        <input type="text" class="text-field w-input" maxlength="256" placeholder="Stock Number" name="stock_number" id="Vehicle-Stock-Number-Modal"
                                            required="" onkeyup="submitFilterForm()">
                                    </div>
                                    <div id="w-node-c0adb514-f4ff-0d6d-6bd8-03d2a5bc87a7-a2dac75e">
                                        <div>
                                            <!-- <h6>Part Type</h6> -->
                                            <select name="category" id="category-Modal" class="text-field w-select" required onchange="submitFilterModalForm()">
                                                <option value="" selected disabled>Select Part Type</option>
                                                {% for category in categories %}
                                                <option value="{{ category }}">{{ category }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                    <div id="w-node-c0adb514-f4ff-0d6d-6bd8-03d2a5bc87a1-a2dac75e">
                                        <div>
                                            <!-- <h6>Vehicle Model</h6> -->
                                            <input type="text" class="text-field w-input" maxlength="256" placeholder="VIN" name="vin" id="vin-Modal"
                                                required="" onkeyup="submitFilterModalForm()">
                                        </div>
                                    </div>
                                    <a id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#" class="button bg-primary-rose w-inline-block" style="width: 100%; display: flex; align-items: center; height: 37px;" onclick="clearFilters()">
                                        <div>Clear</div>
                                    </a>
                                    <a id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#" class="button bg-primary-green w-inline-block" style="width: 100%; display: flex; align-items: center; height: 37px;" onclick="closeModal()">
                                        <div>Filter</div>
                                    </a>
                            </form>
                            </div>
                        
                        </div>
                        <div class="module" style="padding: 0">
                            <div style="margin: 16px 16px 0px 16px; display: flex; justify-content: end;">
                                <!-- <div id="edit-button">
                                    <a id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#"  class="button bg-primary-blue w-inline-block" style="width: auto; display: flex; align-items: center; height: 37px; padding: 12px 12px;">
                                        <img style="height: 25px; margin-right: 2px" src="/static/icons/edit.svg" loading="lazy" alt="" class="nav-icon edit-icon">   Edit Vehicles
                                    </a>
                                </div> -->
                                
                                
                            </div>
                            <div class="table-header" style="display: flex; justify-content: space-between;">
                                <h4 class="no-space-bottom">All Vehicles</h4>
                                <div style="display: flex;">
                                    <div style="margin-right: 6px;">
                                        <a id="filter-button"
                                                class="button bg-primary-green w-inline-block" style="width: auto; align-items: center; height: 37px; padding: 12px 12px;">Filter
                                        </a>
                                    </div>
                                    <div id="edit-button-1" style="margin-right: 6px">
                                        <a title="Edit Vehicle Category" id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#"  class="button bg-primary-blue w-inline-block" style="width: auto; display: flex; align-items: center; height: 37px; padding: 12px 12px;">
                                            <img style="height: 25px; margin-right: 2px" src="/static/icons/edit.svg" loading="lazy" alt="" class="nav-icon edit-icon">
                                        </a>
                                    </div>
                                    <div id="edit-location-1" style="margin-right: 6px">
                                        <a title="Edit Vehicle Location" id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#"  class="button bg-primary-blue w-inline-block" style="width: auto; display: flex; align-items: center; height: 37px; padding: 12px 12px;">
                                            <img style="height: 25px; margin-right: 2px" src="/static/icons/pin.svg" loading="lazy" alt="" class="nav-icon edit-icon">
                                        </a>
                                    </div>
                                    <div id="cancel-button-1">
                                        <a title="Cancel" id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#"  class="button bg-primary-rose w-inline-block" style="width: auto; display: flex; align-items: center; height: 37px; padding: 12px 12px; background-color: #DA4167;">
                                            <img style="height: 25px; margin-right: 2px" src="/static/icons/cancel.svg" loading="lazy" alt="" class="nav-icon edit-icon">
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="table-module" id="table-container">
                                <div class="table-content" style="margin-top: 15px; margin-bottom: 15px">
                                    <div class="table-list">
                                        <div class="w-layout-grid table-headers mobile-table">
                                            <div class="caption-large select-column"></div>
                                            <div class="caption-large tablet mobile">Year</div>
                                            <div class="caption-large mobile tablet">Make</div>
                                            <div class="caption-large mobile">Model</div>
                                            <div class="caption-large">STK #</div>
                                            <div class="caption-large">VIN</div>
                                            <div class="caption-large">Category</div>
                                        </div>
                                        {% if vehicles %}
                                            {% for vehicle in vehicles %}
                                                <a href="{% url 'single_vehicle' vehicle.id %}" target="_blank">
                                                    <div class="w-layout-grid table-row">
                                                        <td><input type="checkbox" name="vehicle"  style="width: 30px; height: 30px;" value="{{ vehicle.id }}"></td>
                                                        <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31" class="tablet mobile">{{ vehicle.year }}</div>
                                                        <div class="tablet mobile">{{ vehicle.make }}</div>
                                                        <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f8a-cbeb6f31" class="table-title mobile">
                                                            {{ vehicle.model }}
                                                        </div>
                                                        <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31" class="">{{ vehicle.stock_number|default:"" }}</div>
                                                        <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31" >{{ vehicle.vin|default:""|slice:"-6:" }}</div>
                                                        <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31">{{ vehicle.category|default:"" }}</div>
                                                    </div>
                                                </a>
                                            {% endfor %}
                                        {% endif %}
                                    </div>
                                    <div class="pagination" style="display: flex; width: 100%; justify-content: flex-end; margin-bottom: 20px; margin-top: 20px;">
                                        <span class="step-links" style="margin-right: 20px">
                                            {% if vehicles.has_previous %}
                                            <!-- <a href="?page=1">&laquo; first</a> -->
                                            <a style="width: 50px" href="?page={{ vehicles.previous_page_number }}"><input type="button"
                                                    value="<" class="button button-small w-button"></a>
                                            {% else %}
                                            <input type="button" value="<" class="button button-small w-button" disabled>
                                            {% endif %}
                            
                                            <span class="current" style="width: 50px">
                                                {{ vehicles.number }} of {{ vehicles.paginator.num_pages }}
                                            </span>
                            
                                            {% if vehicles.has_next %}
                                            <a href="?page={{ vehicles.next_page_number }}"><input type="button" value=">"
                                                    class="button button-small w-button"></a>
                                            {% else %}
                                            <input type="button" value=">" class="button button-small w-button" disabled>
                                            {% endif %}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div data-w-tab="Incoming" class="w-tab-pane w--tab-active" id="w-tabs-0-data-w-pane-0" role="tabpanel"
                    aria-labelledby="w-tabs-0-data-w-tab-0" style="opacity: 1; transition: opacity 300ms ease 0s;">
                    <div class="w-layout-grid main-grid">
                        <div class="table-module">
                            <div class="table-header" style="display: flex; justify-content: space-between;">
                                <h4 class="no-space-bottom">Incoming</h4>
                                <div style="display: flex;">
                                    <div id="edit-button-2" style="margin-right: 6px">
                                        <a title="Edit Vehicle Category" id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#"  class="button bg-primary-blue w-inline-block" style="width: auto; display: flex; align-items: center; height: 37px; padding: 12px 12px;">
                                            <img style="height: 25px; margin-right: 2px" src="/static/icons/edit.svg" loading="lazy" alt="" class="nav-icon edit-icon">
                                        </a>
                                    </div>
                                    <div id="edit-location-2" style="margin-right: 6px">
                                        <a title="Edit Vehicle Location" id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#"  class="button bg-primary-blue w-inline-block" style="width: auto; display: flex; align-items: center; height: 37px; padding: 12px 12px;">
                                            <img style="height: 25px; margin-right: 2px" src="/static/icons/pin.svg" loading="lazy" alt="" class="nav-icon edit-icon">
                                        </a>
                                    </div>
                                    <div id="cancel-button-2">
                                        <a title="Cancel" id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#"  class="button bg-primary-rose w-inline-block" style="width: auto; display: flex; align-items: center; height: 37px; padding: 12px 12px; background-color: #DA4167;">
                                            <img style="height: 25px; margin-right: 2px" src="/static/icons/cancel.svg" loading="lazy" alt="" class="nav-icon edit-icon">
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="table-module" id="table-container">
                                <div class="table-content" style="margin-top: 15px; margin-bottom: 15px">
                                    <div class="table-list">
                                        <div class="w-layout-grid table-headers mobile-table">
                                            <div class="caption-large select-column"></div>
                                            <div class="caption-large tablet mobile">Year</div>
                                            <div class="caption-large mobile tablet">Make</div>
                                            <div class="caption-large mobile">Model</div>
                                            <div class="caption-large">STK #</div>
                                            <div class="caption-large">VIN</div>
                                            <div class="caption-large">Category</div>
                                        </div>
                                        {% if incomingVehicles %}
                                            {% for vehicle in incomingVehicles %}
                                                <div class="w-layout-grid table-row">
                                                    <td><input type="checkbox" name="vehicle"  style="width: 30px; height: 30px;" value="{{ vehicle.id }}"></td>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31" class="tablet mobile">{{ vehicle.year }}</div>
                                                    <div class="tablet mobile">{{ vehicle.make }}</div>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f8a-cbeb6f31" class="table-title mobile">
                                                        {{ vehicle.model }}
                                                    </div>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31" class="">{{ vehicle.stock_number|default:"" }}</div>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31" >{{ vehicle.vin|default:""|slice:"-6:" }}</div>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31">{{ vehicle.category|default:"" }}</div>
                                                </div>
                                            {% endfor %}
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div data-w-tab="Holding" class="w-tab-pane" id="w-tabs-0-data-w-pane-1" role="tabpanel"
                    aria-labelledby="w-tabs-0-data-w-tab-1" style="">
                    <div class="w-layout-grid main-grid">
                        <div class="table-module">
                            <div class="table-header" style="display: flex; justify-content: space-between;">
                                <h4 class="no-space-bottom">In Holding</h4>
                                <div style="display: flex;">
                                    <div id="edit-button-3" style="margin-right: 6px">
                                        <a title="Edit Vehicle Category" id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#"  class="button bg-primary-blue w-inline-block" style="width: auto; display: flex; align-items: center; height: 37px; padding: 12px 12px;">
                                            <img style="height: 25px; margin-right: 2px" src="/static/icons/edit.svg" loading="lazy" alt="" class="nav-icon edit-icon">
                                        </a>
                                    </div>
                                    <div id="edit-location-3" style="margin-right: 6px">
                                        <a title="Edit Vehicle Location" id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#"  class="button bg-primary-blue w-inline-block" style="width: auto; display: flex; align-items: center; height: 37px; padding: 12px 12px;">
                                            <img style="height: 25px; margin-right: 2px" src="/static/icons/pin.svg" loading="lazy" alt="" class="nav-icon edit-icon">
                                        </a>
                                    </div>
                                    <div id="cancel-button-3">
                                        <a title="Cancel" id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#"  class="button bg-primary-rose w-inline-block" style="width: auto; display: flex; align-items: center; height: 37px; padding: 12px 12px; background-color: #DA4167;">
                                            <img style="height: 25px; margin-right: 2px" src="/static/icons/cancel.svg" loading="lazy" alt="" class="nav-icon edit-icon">
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="table-module" id="table-container">
                                <div class="table-content" style="margin-top: 15px; margin-bottom: 15px">
                                    <div class="table-list">
                                        <div class="w-layout-grid table-headers mobile-table">
                                            <div class="caption-large select-column"></div>
                                            <div class="caption-large tablet mobile">Year</div>
                                            <div class="caption-large mobile tablet">Make</div>
                                            <div class="caption-large mobile">Model</div>
                                            <div class="caption-large">STK #</div>
                                            <div class="caption-large">VIN</div>
                                            <div class="caption-large">Category</div>
                                        </div>
                                        {% if holdingVehicles %}
                                            {% for vehicle in holdingVehicles %}
                                                <div class="w-layout-grid table-row {{ vehicle.category|slugify}}">
                                                    <td><input type="checkbox" name="vehicle"  style="width: 30px; height: 30px;" value="{{ vehicle.id }}"></td>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31" class="tablet mobile">{{ vehicle.year }}</div>
                                                    <div class="tablet mobile">{{ vehicle.make }}</div>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f8a-cbeb6f31" class="table-title mobile">
                                                        {{ vehicle.model }}
                                                    </div>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31" class="">{{ vehicle.stock_number|default:"" }}</div>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31" >{{ vehicle.vin|default:""|slice:"-6:" }}</div>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31">{{ vehicle.category|default:"" }}</div>
                                                </div>
                                            {% endfor %}
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div data-w-tab="Pre-Strip" class="w-tab-pane" id="w-tabs-0-data-w-pane-2" role="tabpanel"
                    aria-labelledby="w-tabs-0-data-w-tab-2">
                    <div class="w-layout-grid main-grid">
                        <div class="table-module">
                            <div class="table-header" style="display: flex; justify-content: space-between;">
                                <h4 class="no-space-bottom">Ready For Stripping</h4>
                                <div style="display: flex;">
                                    <div id="edit-button-4" style="margin-right: 6px">
                                        <a title="Edit Vehicle Category" id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#"  class="button bg-primary-blue w-inline-block" style="width: auto; display: flex; align-items: center; height: 37px; padding: 12px 12px;">
                                            <img style="height: 25px; margin-right: 2px" src="/static/icons/edit.svg" loading="lazy" alt="" class="nav-icon edit-icon">
                                        </a>
                                    </div>
                                    <div id="edit-location-4" style="margin-right: 6px">
                                        <a title="Edit Vehicle Location" id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#"  class="button bg-primary-blue w-inline-block" style="width: auto; display: flex; align-items: center; height: 37px; padding: 12px 12px;">
                                            <img style="height: 25px; margin-right: 2px" src="/static/icons/pin.svg" loading="lazy" alt="" class="nav-icon edit-icon">
                                        </a>
                                    </div>
                                    <div id="cancel-button-4">
                                        <a title="Cancel" id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#"  class="button bg-primary-rose w-inline-block" style="width: auto; display: flex; align-items: center; height: 37px; padding: 12px 12px; background-color: #DA4167;">
                                            <img style="height: 25px; margin-right: 2px" src="/static/icons/cancel.svg" loading="lazy" alt="" class="nav-icon edit-icon">
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="table-module" id="table-container">
                                <div class="table-content" style="margin-top: 15px; margin-bottom: 15px">
                                    <div class="table-list">
                                        <div class="w-layout-grid table-headers mobile-table">
                                            <div class="caption-large select-column"></div>
                                            <div class="caption-large tablet mobile">Year</div>
                                            <div class="caption-large mobile tablet">Make</div>
                                            <div class="caption-large mobile">Model</div>
                                            <div class="caption-large">STK #</div>
                                            <div class="caption-large">VIN</div>
                                            <div class="caption-large">Category</div>
                                        </div>
                                        {% if preStripVehicles %}
                                            {% for vehicle in preStripVehicles %}
                                                <div class="w-layout-grid table-row">
                                                    <td><input type="checkbox" name="vehicle"  style="width: 30px; height: 30px;" value="{{ vehicle.id }}"></td>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31" class="tablet mobile">{{ vehicle.year }}</div>
                                                    <div class="tablet mobile">{{ vehicle.make }}</div>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f8a-cbeb6f31" class="table-title mobile">
                                                        {{ vehicle.model }}
                                                    </div>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31" class="">{{ vehicle.stock_number|default:"" }}</div>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31" >{{ vehicle.vin|default:""|slice:"-6:" }}</div>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31">{{ vehicle.category|default:"" }}</div>
                                                </div>
                                            {% endfor %}
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div data-w-tab="Stripping" class="w-tab-pane" id="w-tabs-0-data-w-pane-2" role="tabpanel"
                    aria-labelledby="w-tabs-0-data-w-tab-2">
                    <div class="w-layout-grid main-grid">
                        <div class="table-module">
                            <div class="table-header" style="display: flex; justify-content: space-between;">
                                <h4 class="no-space-bottom">Being Stripped</h4>
                                <div style="display: flex;">
                                    <div id="edit-button-5" style="margin-right: 6px">
                                        <a title="Edit Vehicle Category" id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#"  class="button bg-primary-blue w-inline-block" style="width: auto; display: flex; align-items: center; height: 37px; padding: 12px 12px;">
                                            <img style="height: 25px; margin-right: 2px" src="/static/icons/edit.svg" loading="lazy" alt="" class="nav-icon edit-icon">
                                        </a>
                                    </div>
                                    <div id="edit-location-5" style="margin-right: 6px">
                                        <a title="Edit Vehicle Location" id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#"  class="button bg-primary-blue w-inline-block" style="width: auto; display: flex; align-items: center; height: 37px; padding: 12px 12px;">
                                            <img style="height: 25px; margin-right: 2px" src="/static/icons/pin.svg" loading="lazy" alt="" class="nav-icon edit-icon">
                                        </a>
                                    </div>
                                    <div id="cancel-button-5">
                                        <a title="Cancel" id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#"  class="button bg-primary-rose w-inline-block" style="width: auto; display: flex; align-items: center; height: 37px; padding: 12px 12px; background-color: #DA4167;">
                                            <img style="height: 25px; margin-right: 2px" src="/static/icons/cancel.svg" loading="lazy" alt="" class="nav-icon edit-icon">
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="table-module" id="table-container">
                                <div class="table-content" style="margin-top: 15px; margin-bottom: 15px">
                                    <div class="table-list">
                                        <div class="w-layout-grid table-headers mobile-table">
                                            <div class="caption-large select-column"></div>
                                            <div class="caption-large tablet mobile">Year</div>
                                            <div class="caption-large mobile tablet">Make</div>
                                            <div class="caption-large mobile">Model</div>
                                            <div class="caption-large">STK #</div>
                                            <div class="caption-large">VIN</div>
                                            <div class="caption-large">Category</div>
                                        </div>
                                        {% if stripVehicles %}
                                            {% for vehicle in stripVehicles %}
                                                <div class="w-layout-grid table-row">
                                                    <td><input type="checkbox" name="vehicle"  style="width: 30px; height: 30px;" value="{{ vehicle.id }}"></td>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31" class="tablet mobile">{{ vehicle.year }}</div>
                                                    <div class="tablet mobile">{{ vehicle.make }}</div>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f8a-cbeb6f31" class="table-title mobile">
                                                        {{ vehicle.model }}
                                                    </div>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31" class="">{{ vehicle.stock_number|default:"" }}</div>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31" >{{ vehicle.vin|default:""|slice:"-6:" }}</div>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31">{{ vehicle.category|default:"" }}</div>
                                                </div>
                                            {% endfor %}
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div data-w-tab="Pre-Yard" class="w-tab-pane" id="w-tabs-0-data-w-pane-2" role="tabpanel"
                    aria-labelledby="w-tabs-0-data-w-tab-2">
                    <div class="w-layout-grid main-grid">
                        <div class="table-module">
                            <div class="table-header" style="display: flex; justify-content: space-between;">
                                <h4 class="no-space-bottom">Ready For Yard</h4>
                                <div style="display: flex;">
                                    <div id="edit-button-6" style="margin-right: 6px">
                                        <a title="Edit Vehicle Category" id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#"  class="button bg-primary-blue w-inline-block" style="width: auto; display: flex; align-items: center; height: 37px; padding: 12px 12px;">
                                            <img style="height: 25px; margin-right: 2px" src="/static/icons/edit.svg" loading="lazy" alt="" class="nav-icon edit-icon">
                                        </a>
                                    </div>
                                    <div id="edit-location-6" style="margin-right: 6px">
                                        <a title="Edit Vehicle Location" id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#"  class="button bg-primary-blue w-inline-block" style="width: auto; display: flex; align-items: center; height: 37px; padding: 12px 12px;">
                                            <img style="height: 25px; margin-right: 2px" src="/static/icons/pin.svg" loading="lazy" alt="" class="nav-icon edit-icon">
                                        </a>
                                    </div>
                                    <div id="cancel-button-6">
                                        <a title="Cancel" id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#"  class="button bg-primary-rose w-inline-block" style="width: auto; display: flex; align-items: center; height: 37px; padding: 12px 12px; background-color: #DA4167;">
                                            <img style="height: 25px; margin-right: 2px" src="/static/icons/cancel.svg" loading="lazy" alt="" class="nav-icon edit-icon">
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="table-module" id="table-container">
                                <div class="table-content" style="margin-top: 15px; margin-bottom: 15px">
                                    <div class="table-list">
                                        <div class="w-layout-grid table-headers mobile-table">
                                            <div class="caption-large select-column"></div>
                                            <div class="caption-large tablet mobile">Year</div>
                                            <div class="caption-large mobile tablet">Make</div>
                                            <div class="caption-large mobile">Model</div>
                                            <div class="caption-large">STK #</div>
                                            <div class="caption-large">VIN</div>
                                            <div class="caption-large">Category</div>
                                        </div>
                                        {% if preYardVehicles %}
                                            {% for vehicle in preYardVehicles %}
                                                <div class="w-layout-grid table-row">
                                                    <td><input type="checkbox" name="vehicle"  style="width: 30px; height: 30px;" value="{{ vehicle.id }}"></td>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31" class="tablet mobile">{{ vehicle.year }}</div>
                                                    <div class="tablet mobile">{{ vehicle.make }}</div>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f8a-cbeb6f31" class="table-title mobile">
                                                        {{ vehicle.model }}
                                                    </div>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31" class="">{{ vehicle.stock_number|default:"" }}</div>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31" >{{ vehicle.vin|default:""|slice:"-6:" }}</div>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31">{{ vehicle.category|default:"" }}</div>
                                                </div>
                                            {% endfor %}
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div data-w-tab="For-Sale" class="w-tab-pane" id="w-tabs-0-data-w-pane-2" role="tabpanel"
                    aria-labelledby="w-tabs-0-data-w-tab-2">
                    <div class="w-layout-grid main-grid">
                        <div class="table-module">
                            <div class="table-header" style="display: flex; justify-content: space-between;">
                                <h4 class="no-space-bottom">Ready For Yard</h4>
                                <div style="display: flex;">
                                    <div id="edit-button-7" style="margin-right: 6px">
                                        <a title="Edit Vehicle Category" id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#"  class="button bg-primary-blue w-inline-block" style="width: auto; display: flex; align-items: center; height: 37px; padding: 12px 12px;">
                                            <img style="height: 25px; margin-right: 2px" src="/static/icons/edit.svg" loading="lazy" alt="" class="nav-icon edit-icon">
                                        </a>
                                    </div>
                                    <div id="edit-location-7" style="margin-right: 6px">
                                        <a title="Edit Vehicle Location" id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#"  class="button bg-primary-blue w-inline-block" style="width: auto; display: flex; align-items: center; height: 37px; padding: 12px 12px;">
                                            <img style="height: 25px; margin-right: 2px" src="/static/icons/pin.svg" loading="lazy" alt="" class="nav-icon edit-icon">
                                        </a>
                                    </div>
                                    <div id="cancel-button-7">
                                        <a title="Cancel" id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#"  class="button bg-primary-rose w-inline-block" style="width: auto; display: flex; align-items: center; height: 37px; padding: 12px 12px; background-color: #DA4167;">
                                            <img style="height: 25px; margin-right: 2px" src="/static/icons/cancel.svg" loading="lazy" alt="" class="nav-icon edit-icon">
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="table-module" id="table-container">
                                <div class="table-content" style="margin-top: 15px; margin-bottom: 15px">
                                    <div class="table-list">
                                        <div class="w-layout-grid table-headers mobile-table">
                                            <div class="caption-large select-column"></div>
                                            <div class="caption-large tablet mobile">Year</div>
                                            <div class="caption-large mobile tablet">Make</div>
                                            <div class="caption-large mobile">Model</div>
                                            <div class="caption-large">STK #</div>
                                            <div class="caption-large">VIN</div>
                                            <div class="caption-large">Category</div>
                                        </div>
                                        {% if forSaleVehicles %}
                                            {% for vehicle in forSaleVehicles %}
                                                <div class="w-layout-grid table-row">
                                                    <td><input type="checkbox" name="vehicle"  style="width: 30px; height: 30px;" value="{{ vehicle.id }}"></td>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31" class="tablet mobile">{{ vehicle.year }}</div>
                                                    <div class="tablet mobile">{{ vehicle.make }}</div>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f8a-cbeb6f31" class="table-title mobile">
                                                        {{ vehicle.model }}ss
                                                    </div>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31" class="">{{ vehicle.stock_number|default:"" }}</div>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31" >{{ vehicle.vin|default:""|slice:"-6:" }}</div>
                                                    <div id="w-node-_6d0a7d03-8948-d1f4-7211-3504eaac5f94-cbeb6f31">{{ vehicle.category|default:"" }}</div>
                                                </div>
                                            {% endfor %}
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="vehicleEditModal" class="modal" style="display: none">
            <div class="modal-content" style="width: 300px;">
                <span class="close" id="editVehicleClose">&times;</span>
                <h6>Edit Vehicles</h6>
                <form id="filter-form-modal" class="" style="width: 100%">
                    <div id="w-node-c0adb514-f4ff-0d6d-6bd8-03d2a5bc87a1-a2dac75e" style="margin-bottom: 16px;">
                        <div>
                            <select name="category" id="category-edit" class="text-field w-select">
                                <option value="" selected disabled>Select Category</option>
                                {% for category in categories %}
                                {% if category in vehicle.category %}
                                <option value="{{ category }}" selected>{{ category }}</option>
                                {% else %}
                                <option value="{{ category }}">{{ category }}</option>
                                {% endif %}
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div id="w-node-c0adb514-f4ff-0d6d-6bd8-03d2a5bc87a1-a2dac75e" style="display: none;">
                        <div>
                            <input type="text" class="text-field w-input" maxlength="256" placeholder="Row" name="row" id="row-edit"
                                required>
                        </div>
                    </div>
                    <div id="w-node-c0adb514-f4ff-0d6d-6bd8-03d2a5bc87a1-a2dac75e" style="display: none;">
                        <div>
                            <input type="text" class="text-field w-input" maxlength="256" placeholder="Location" name="location" id="location-edit"
                                required>
                        </div>
                    </div>
                    <a id="w-node-_4a591f9f-f950-9529-d551-da13bb960451-a2dac75e" href="#" class="button bg-primary-green w-inline-block" style="width: 100%; display: flex; align-items: center; height: 37px;" onclick="saveVehicleChanges()">
                        <div>Save Change</div>
                    </a>
            </form>
            </div>
        
        </div>
    </div>

<script>
    function clearCircleMarkers(map) {
        map.eachLayer(function (layer) {
            if (layer instanceof L.LayerGroup || layer instanceof L.FeatureGroup) {
                // If the layer is a group, recursively clear its children
                clearCircleMarkers(layer);
            } else if (layer instanceof L.CircleMarker) {
                // If the layer is a circle marker, remove it
                map.removeLayer(layer);
            }
        });
    }


    var editVehicleModal = document.getElementById("vehicleEditModal");
    var editVehicleBtn1 = document.getElementById("edit-button-1");
    var editVehicleBtn2 = document.getElementById("edit-button-2");
    var editVehicleBtn3 = document.getElementById("edit-button-3");
    var editVehicleBtn4 = document.getElementById("edit-button-4");
    var editVehicleBtn5 = document.getElementById("edit-button-5");
    var editVehicleBtn6 = document.getElementById("edit-button-6");
    var editVehicleBtn7 = document.getElementById("edit-button-7");
    var editVehicleLctnBtn1 = document.getElementById("edit-location-1");
    var editVehicleLctnBtn2 = document.getElementById("edit-location-2");
    var editVehicleLctnBtn3 = document.getElementById("edit-location-3");
    var editVehicleLctnBtn4 = document.getElementById("edit-location-4");
    var editVehicleLctnBtn5 = document.getElementById("edit-location-5");
    var editVehicleLctnBtn6 = document.getElementById("edit-location-6");
    var editVehicleLctnBtn7 = document.getElementById("edit-location-7");
    var cancelBtn1 = document.getElementById("cancel-button-1");
    var cancelBtn2 = document.getElementById("cancel-button-2");
    var cancelBtn3 = document.getElementById("cancel-button-3");
    var cancelBtn4 = document.getElementById("cancel-button-4");
    var cancelBtn5 = document.getElementById("cancel-button-5");
    var cancelBtn6 = document.getElementById("cancel-button-6");
    var cancelBtn7 = document.getElementById("cancel-button-7");


    var editCategoryButtons = [editVehicleBtn1, editVehicleBtn2, editVehicleBtn3, editVehicleBtn4, editVehicleBtn5, editVehicleBtn6, editVehicleBtn7];
    var editLocationButtons = [editVehicleLctnBtn1, editVehicleLctnBtn2, editVehicleLctnBtn3, editVehicleLctnBtn4, editVehicleLctnBtn5, editVehicleLctnBtn6, editVehicleLctnBtn7];
    var cancelButtons = [cancelBtn1, cancelBtn2, cancelBtn3, cancelBtn4, cancelBtn5, cancelBtn6, cancelBtn7];

    for (var i = 0; i < cancelButtons.length; i++) {
        cancelButtons[i].onclick = function () {
            location.reload();
        }
    }

    for (var i = 0; i < editCategoryButtons.length; i++) {
        editCategoryButtons[i].onclick = function () {
            var selectedVehicleIds = [];
            $('input[type="checkbox"][name="vehicle"]:checked').each(function () {
                selectedVehicleIds.push($(this).val()); // Collecting IDs of checked vehicles
            });
            if (selectedVehicleIds.length === 0) {
                alert("Please select at least one vehicle to edit.");
            } else {
                editVehicleModal.style.display = 'block';
            }
        }
    }

    
    


    var editVehicleModalSpan = document.getElementById("editVehicleClose");

    editVehicleModalSpan.onclick = function () {

        editVehicleModal.style.display = "none";
    }
    function clearVehicleCheckboxes() {
        // Select all checkboxes with the name 'part' and loop through them
        document.querySelectorAll('input[type="checkbox"][name="vehicle"]').forEach(function(checkbox) {
            checkbox.checked = false; // Uncheck the checkbox
        });
    }
    function saveVehicleChanges() {
        var selectedVehicleIds = [];
        $('input[type="checkbox"][name="vehicle"]:checked').each(function () {
            selectedVehicleIds.push($(this).val()); // Collecting IDs of checked vehicles
        });

        var row = document.getElementById('row-edit').value;
        var location = document.getElementById('location-edit').value;
        var category = document.getElementById('category-edit').value;

        if (!location && !row && category === "") {
            alert("Please fill out at least one field before saving changes.");
            return false; // Stop the form submission
        }
        var data = {
            vehicleIds: selectedVehicleIds,
            location: location,
            category: category,
            row: row
        };

        

        let params = new URLSearchParams(data).toString();
        fetch("{% url 'vehicles' %}?" + params, {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-Request-Type': 'vehicleEdit'
            }
        })
        .then(response => response.text())
        .then(html => {
            clearVehicleCheckboxes();
            editVehicleModal.style.display = "none";
            window.location.reload();


        })
        .catch(error => console.error('Error:', error));

    }
    var modal = document.getElementById("myModal");
    var btn = document.getElementById("filter-button");
    var span = document.getElementsByClassName("close")[0];
    btn.onclick = function () {
        modal.style.display = "block";
    }
    span.onclick = function () {
        modal.style.display = "none";
    }

    


    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function (event) {
        if (event.target == modal || event.target == editVehicleModal) {
            modal.style.display = "none";
            editVehicleModal.style.display = "none";
        }
    }
    function closeModal() {
        var modal = document.getElementById("myModal");
        modal.style.display = "none";
    }


    function clearFilters() {
        document.getElementById('Year-Start').selectedIndex = 0;
        document.getElementById('Year-Start').selectedIndex = 0;
        document.getElementById('category').selectedIndex = 0;
        document.getElementById('vin').selectedIndex = 0;
        document.getElementById('Vehicle-Model').value = '';
        document.getElementById('Vehicle-Make').value = '';
        document.getElementById('Vehicle-Stock-Number').value = '';

        document.getElementById('Year-Start-Modal').selectedIndex = 0;
        document.getElementById('Year-Start-Modal').selectedIndex = 0;
        document.getElementById('vin-Modal').selectedIndex = 0;
        document.getElementById('category-Modal').selectedIndex = 0;
        document.getElementById('Vehicle-Model-Modal').value = '';
        document.getElementById('Vehicle-Make-Modal').value = '';
        document.getElementById('Vehicle-Stock-Number-Modal').value = '';
        

        // If you are using any plugins like Select2, you may need to trigger a change event
        // so that the visual component updates correctly.
        $('#Year-Start').val(null).trigger('change');
        $('#Year-End').val(null).trigger('change');
        $('#category').val(null).trigger('change');
        $('#vin').val(null).trigger('change');
        $('#Year-Start-Modal').val(null).trigger('change');
        $('#Year-End-Modal').val(null).trigger('change');
        $('#category-Modal').val(null).trigger('change');
        $('#vin-Modal').val(null).trigger('change');
        $('#Vehicle-Stock-Number').val(null).trigger('change');
        // Trigger the filter form submission to refresh the results
        submitFilterForm();
        submitFilterModalForm();
    }


    function submitFilterForm() {
        var formData = new FormData(document.forms[0]);

        var queryParams = new URLSearchParams();
        for (var pair of formData.entries()) {
            queryParams.append(pair[0], pair[1]);
        }

        fetch("{% url 'vehicles' %}?" + queryParams.toString(), {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-Request-Type': 'vehicleFilter'
            }
        })
        .then(response => response.text())
        .then(html => {
            document.getElementById('table-container').innerHTML = html;
        })
        .catch(error => console.error('Error:', error));
    }
    function submitFilterModalForm() {
        var formData = new FormData(document.forms[1]);
        var queryParams = new URLSearchParams();

        for (var pair of formData.entries()) {
            queryParams.append(pair[0], pair[1]);
        }

        fetch("{% url 'vehicles' %}?" + queryParams.toString(), {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-Request-Type': 'clearVehicleFilter'
            }
        })
        .then(response => response.text())
        .then(html => {
            document.getElementById('table-container').innerHTML = html;
        })
        .catch(error => console.error('Error:', error));
    }

    // clears selected vehicles everytime the tab is changed
    document.addEventListener('DOMContentLoaded', function() {
        // Function to clear all vehicle checkboxes
        function clearVehicleSelections() {
            // Find all vehicle checkboxes by name and reset their 'checked' state
            document.querySelectorAll('input[name="vehicle"]').forEach(function(checkbox) {
                checkbox.checked = false;
            });
        }

        // Add click event listeners to each in-page menu link
        document.querySelectorAll('.in-page-menu-link').forEach(function(link) {
            link.addEventListener('click', function(event) {
                clearVehicleSelections();
            });
        });
    });
    googleSat = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{
        maxZoom: 20,
        subdomains:['mt0','mt1','mt2','mt3']
    });

    var vehicleMap = L.map(`vehicle-map`).setView([{{ user.location.latitude }}, {{ user.location.longitude }}], 16);
    googleSat.addTo(vehicleMap);
    vehicleMap.pm.removeControls();
    vehicleMap.pm.addControls({
        position: 'topright', 
        drawCircle: false,    
        drawMarker: false,
        drawCircleMarker: false, 
        drawPolygon: false,
        drawPolyline: false,  
        drawRectangle: false, 
        editMode: false,       
        dragMode: false,      
        cutPolygon: false,    
        removalMode: false,  
        rotateMode: false,
        drawText: false,
            });

    vehicles = ({{ vehiclesJson|safe }});


    

    document.addEventListener('DOMContentLoaded', function() {
        // Select all tab links
        var tabLinks = document.querySelectorAll('.w-tab-link');

        emptyVehicleSpots = ({{ emptyVehicleSpots|safe }})
        vehiclesWithMarkers = {{ markedVehicles|safe }}

        emptyVehicleSpots.forEach(function(bounds) {
            var latLngBounds = L.latLngBounds([bounds._southWest.lat, bounds._southWest.lng], [bounds._northEast.lat, bounds._northEast.lng]);
            rectangle = L.rectangle(latLngBounds, {color: "#ffffff", weight: 1}).addTo(vehicleMap)
        });

        buildMarkedVehicleSpots(vehiclesWithMarkers, vehicleMap);

        
        tabLinks.forEach(function(link) {
            link.addEventListener('click', function(event) {
                // Prevent default anchor behavior
                event.preventDefault();
                
                var tabName = this.getAttribute('data-w-tab');

                clearCircleMarkers(vehicleMap);
                if (tabName === 'All') {
                    vehicles = ({{ vehiclesJson|safe }});
                } else if (tabName === 'Incoming'){
                    vehicles = JSON.parse({{ incomingVehiclesJson|safe }});
                } else if (tabName === "Holding"){
                    vehicles = JSON.parse({{ holdingVehiclesJson|safe }});
                } else if (tabName === "Pre-Strip"){
                    vehicles = JSON.parse({{ preStripVehiclesJson|safe }});
                } else if (tabName === "Stripping"){
                    vehicles = JSON.parse({{ stripVehiclesJson|safe }});
                } else if (tabName === "Pre-Yard"){
                    vehicles = JSON.parse({{ preYardVehiclesJson|safe }});
                } else if (tabName === "For-Sale"){
                    vehicles = JSON.parse({{ forSaleVehiclesJson|safe }});
                }
                for (let i = 0; i < vehicles.length; i++) {
                    const vehicle = vehicles[i];
                    if (vehicle.fields.latitude != null && vehicle.fields.longitude != null){
                        iconColor = "#FFFFFF";
                        if (vehicle.fields.category == "ENROUTE" || vehicle.fields.category == "PROCESSING"){
                            iconColor = "#fff004"
                        } else if (vehicle.fields.category == "CRUSHED"){
                            iconColor = "#f44336"
                        } else if (vehicle.fields.category == "YARD"){
                            iconColor = "#4336f4"
                        } else if (vehicle.fields.category == "NO TITLE"){
                            iconColor = "#F2CEE6"
                        } else if (vehicle.fields.categroy == "TITLE PROBLEM"){
                            iconColor = "#DA4167"
                        } else if (vehicle.fields.category == "NEEDS A STICKER"){
                            iconColor = "#EED897"
                        } else if (vehicle.fields.category == "VIN NOT IN SYSTEM"){
                            iconColor = "#C3DBC5"
                        }
                        else {
                            iconColor = "#FFFFFF"
                        }

                        customMarker = {
                            radius: 5,
                            fillColor: iconColor,
                            color: iconColor,
                            weight: 5,
                            opacity: 1,
                            fillOpacity: 0.8
                        };
                        const marker = L.circleMarker([vehicle.fields.latitude, vehicle.fields.longitude], customMarker).addTo(vehicleMap);
                        marker.bindPopup(`<strong><a href="/dashboards/single_vehicle/${vehicle.pk}">${vehicle.fields.year} ${vehicle.fields.make} ${vehicle.fields.model}<br>STK: ${vehicle.fields.stock_number}<br>${vehicle.fields.vin}<br>${vehicle.fields.category}</a></strong>`);
                    }
                }
                
            });
        });
    });
    for (var i = 0; i < editLocationButtons.length; i++) {
        (function() {
            editLocationButton = editLocationButtons[i];
            editLocationButton.onclick = function () {
                var selectedVehicleIds = [];
                $('input[type="checkbox"][name="vehicle"]:checked').each(function () {
                    selectedVehicleIds.push($(this).val()); // Collecting IDs of checked vehicles
                });
                
                if (selectedVehicleIds.length === 0) {
                    alert("Please select at least one vehicle to edit the location.");
                } else if (selectedVehicleIds.length > 1) {
                    alert("Please select only one vehicle to edit the location.");
                } else {
                    selectedMarker = null;
                    clearCircleMarkers(vehicleMap);
                    alert("Select a new vehicle location.")
                    emptyVehicleSpots = ({{ emptyVehicleSpots|safe }})
                    buildVehicleMap(emptyVehicleSpots, vehicleMap, selectedVehicleIds[0]);
                    
                }
            }
        })();
    }

    function buildVehicleMap(emptyVehicleSpots, vehicleMap, vehicleId) {
        emptyVehicleSpots = ({{ emptyVehicleSpots|safe }})
        emptyVehicleSpots.forEach(function(bounds) {
            var latLngBounds = L.latLngBounds([bounds._southWest.lat, bounds._southWest.lng], [bounds._northEast.lat, bounds._northEast.lng]);
            rectangle = L.rectangle(latLngBounds, {color: "#ffffff", weight: 1}).addTo(vehicleMap)
            rectangle.on('click', function(e) {
                vehicleMap.eachLayer(function(layer) {
                    if (!(layer instanceof L.TileLayer)) {
                        vehicleMap.removeLayer(layer);
                    }
                });
                setVehicleMarker(vehicleMap, latLngBounds, vehicleId);

            });
        });

    }
    function setVehicleMarker(vehicleMap, selectedMarker, vehicleId) {
        var selectedMarkerString = JSON.stringify(selectedMarker);

        var queryParams = new URLSearchParams();
        queryParams.append('vehicleId', vehicleId);
        queryParams.append('selectedMarker', selectedMarkerString);
        fetch("{% url 'vehicles' %}?" + queryParams.toString(), {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-Request-Type': 'newVehicleLocation'
            }
        })
        .then(response => response.json())
        .then(data => {
            emptyVehicleSpots = JSON.parse(data['locationEmptySpots']);
            vehiclesWithMarkers = data['vehiclesWithMarkers'];
            emptyVehicleSpots.forEach(function(bounds) {
                var latLngBounds = L.latLngBounds([bounds._southWest.lat, bounds._southWest.lng], [bounds._northEast.lat, bounds._northEast.lng]);
                rectangle = L.rectangle(latLngBounds, {color: "#ffffff", weight: 1}).addTo(vehicleMap)
            });
            buildMarkedVehicleSpots(vehiclesWithMarkers, vehicleMap);
        })
        .catch(error => console.error('Error:', error));
    }
    function buildMarkedVehicleSpots(vehiclesArray, map){
        vehiclesArray.forEach(function(vehicle){
            bounds = JSON.parse(vehicle.marker);
            var latLngBounds = L.latLngBounds([bounds._southWest.lat, bounds._southWest.lng], [bounds._northEast.lat, bounds._northEast.lng]);
            rectangle = L.rectangle(latLngBounds, {color: "#EC407A", weight: 4}).addTo(map)
            rectangle.bindPopup(`<strong><a href="/dashboards/single_vehicle/${vehicle.id}">${vehicle.year} ${vehicle.make} ${vehicle.model}<br>STK: ${vehicle.stock_number}<br>${vehicle.vin}<br>${vehicle.category}</a></strong>`);
        })

    }
</script>
<style>
    .needs-a-sticker {
        background-color: #EED897 !important;
    }
    .title-problem {
        background-color: #DA4167 !important;
    }
    .no-title {
        background-color: #F2CEE6 !important;
    }
    .vin-not-in-system {
        background-color: #C3DBC5 !important;
    }





    .table-header {
        padding-bottom: 0px !important;
        padding-left: 16px;
        padding-right: 16px;
    }
    .table-row {
        grid-template-columns: .35fr 1fr 1fr 1fr 1fr 1fr 1fr;
    }
    .mobile-table {
        grid-template-columns: .35fr 1fr 1fr 1fr 1fr 1fr  1fr;
    }

    @media screen and (max-width: 1000px) {
        .modal-content {
            width: 90% !important;
            /* Could be more or less, depending on screen size */
        }
    }
    @media screen and (max-width: 730px) {
        .table-row{
            grid-template-columns: .35fr 1fr 1fr 1fr 1fr;

        } 
        .mobile-table {
            grid-template-columns: .35fr 1fr 1fr 1fr 1fr;
        }
        .tablet {
            display: none;
        }
    }
    @media screen and (max-width: 479px) {
        .table-row{
            grid-template-columns: .35fr 1fr 1fr 1fr;

        } 
        .mobile-table {
            grid-template-columns: .35fr 1fr 1fr 1fr;
            grid-column-gap: 0% !important;
            display: inline-grid !important;
        }
        .mobile-map {
            height: 200px !important;
        }
    }
    #filter-button{
            display: none;
        }
    @media screen and (max-width: 991px) {
        #filter-button{
            display: flex;
        }
    }
    .form-row {
        margin-bottom: 10px;
    }

    .selection span {
        border-style: none !important;
    }

    .select2 {
        width: 100% !important;
        max-width: 100% !important;
        height: 38px !important;
    }

    .select2-selection__arrow {
        margin-right: 5px !important;
    }

    .select2-selection {
        height: 38px !important;
        border: 1px solid #e3e3e3 !important;
    }

    span.select2-selection.select2-selection--single {
        border: 1px solid #e1e6f0 !important;
        margin-right: 5px !important;
    }

    span.select2-selection.select2-selection--multiple {
        border: 1px solid #e1e6f0 !important;
        max-height: 100px;
        max-width: 28.75vw !important;
        overflow-y: auto;
    }

    /* The Modal (background) */
    .modal {
        display: none;
        /* Hidden by default */
        position: fixed;
        /* Stay in place */
        z-index: 1000;
        /* Sit on top */
        left: 0;
        top: 0;
        width: 100%;
        /* Full width */
        height: 100%;
        /* Full height */
        overflow: auto;
        /* Enable scroll if needed */
        background-color: rgb(0, 0, 0);
        /* Fallback color */
        background-color: rgba(0, 0, 0, 0.4);
        /* Black w/ opacity */
    }

    /* Modal Content/Box */
    .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        /* 15% from the top and centered */
        padding: 20px;
        border-radius: 16px;
        width: 60%;
        /* Could be more or less, depending on screen size */
    }

    /* The Close Button */
    .close {
        color: #aaa;
        float: right;
        font-size: 50px;
        font-weight: bold;
        margin-bottom: 15px;
        margin-right: 5px;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }
    .in-page-menu::-webkit-scrollbar {
        display: none; /* This will hide the scrollbar in WebKit browsers */
    }

    /* For IE, Edge, and Firefox 64+: */
    .in-page-menu {
        -ms-overflow-style: none;  /* IE and Edge */
        scrollbar-width: none !important;  /* Firefox */
    }
    /* Ensure this applies to the in-page-menu specifically for mobile views */
    @media screen and (max-width: 1200px) {
        .in-page-menu {
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            scrollbar-width: thin; /* For modern browsers */
            scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track); /* Custom scrollbar colors */
        }

        .in-page-menu .in-page-menu-link {
            flex: 0 0 auto;
            display: inline-flex; /* Use inline-flex for the links to align them properly */
            margin-right: 8px; /* Adjust space between tabs */
        }

        /* Styles for the scrollbar */
        .in-page-menu::-webkit-scrollbar {
            height: 4px;
        }

        .in-page-menu::-webkit-scrollbar-thumb {
            background-color: #ccc; /* Scrollbar thumb color */
            border-radius: 2px;
        }

        .in-page-menu::-webkit-scrollbar-track {
            background: #f0f0f0; /* Scrollbar track color */
        }
    }
    .table-headers {
        padding-left: 6px;
        padding-right: 6px;
    }
    .table-row {
        padding-left: 6px;
        padding-right: 6px;
    }
    .mobile-bar{
        z-index: 1001;
    }
    .leaflet-top {
        z-index: 400 !important;
    }
    .sidebar-content {
        z-index: 1000 !important;
    }
</style>
{% endblock %}